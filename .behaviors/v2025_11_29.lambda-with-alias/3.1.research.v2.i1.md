# aws sdk v3 research: lambda deployment with aliases

this document captures the aws sdk v3 typedefs and endpoints relevant to deploying lambdas with iam roles, versions, and aliases.

---

## table of contents

1. [iam role](#iam-role)
2. [iam policy (inline role policies)](#iam-policy-inline-role-policies)
3. [iam policy statement structure](#iam-policy-statement-structure)
4. [lambda function](#lambda-function)
5. [lambda version](#lambda-version)
6. [lambda alias](#lambda-alias)

---

## iam role

package: `@aws-sdk/client-iam`

### endpoints

| operation | command | description |
|-----------|---------|-------------|
| create | `CreateRoleCommand` | creates a new iam role |
| get | `GetRoleCommand` | retrieves role details |
| update | `UpdateRoleCommand` | updates role description and max session duration |
| update trust policy | `UpdateAssumeRolePolicyCommand` | updates the trust relationship policy |
| tag | `TagRoleCommand` | adds tags to a role |
| delete | `DeleteRoleCommand` | deletes a role |

### SdkAwsIamRole (returned from GetRole)

```typescript
interface SdkAwsIamRole {
  // identity - immutable after creation
  RoleId?: string;              // @readonly - stable unique identifier (e.g., "AROA1234567890EXAMPLE")
  Arn?: string;                 // @readonly @primaryKey - amazon resource name
  RoleName?: string;            // @uniqueKey - friendly name (unique within account)
  Path?: string;                // @uniqueKey(composite: Path+RoleName) - organizational path (default: "/")
  CreateDate?: Date;            // @readonly - iso 8601 creation timestamp

  // trust policy
  AssumeRolePolicyDocument?: string;  // json trust policy (url-encoded)

  // configuration
  Description?: string;
  MaxSessionDuration?: number;  // seconds (3600-43200, default: 3600)

  // boundaries and metadata
  PermissionsBoundary?: SdkAwsAttachedPermissionsBoundary;
  Tags?: SdkAwsTag[];
  RoleLastUsed?: SdkAwsRoleLastUsed;  // @readonly - last usage info (trailing 400 days)
}
```

### SdkAwsCreateRoleCommandInput

```typescript
interface SdkAwsCreateRoleCommandInput {
  // required
  RoleName: string;                      // unique within account, case-insensitive
  AssumeRolePolicyDocument: string;      // json trust policy

  // optional
  Path?: string;                         // default: "/"
  Description?: string;
  MaxSessionDuration?: number;           // 3600-43200 seconds
  PermissionsBoundary?: string;          // arn of managed policy
  Tags?: SdkAwsTag[];                    // { Key: string, Value: string }[]
}
```

### SdkAwsUpdateRoleCommandInput

```typescript
interface SdkAwsUpdateRoleCommandInput {
  RoleName: string;            // required
  Description?: string;
  MaxSessionDuration?: number; // 3600-43200 seconds
}
```

### SdkAwsUpdateAssumeRolePolicyCommandInput

```typescript
interface SdkAwsUpdateAssumeRolePolicyCommandInput {
  RoleName: string;        // required
  PolicyDocument: string;  // required - json trust policy
}
```

---

## iam policy (inline role policies)

package: `@aws-sdk/client-iam`

note: aws has two types of policies:
- **inline policies** - embedded directly in a role via `PutRolePolicy`
- **managed policies** - standalone policies attached via `AttachRolePolicy`

for lambda execution roles, inline policies are commonly used for service-specific permissions.

**key identity notes:**
- an inline role policy is uniquely identified by `RoleName` + `PolicyName` (composite unique key)
- inline policies do not have an ARN - they are embedded in the role
- the `PolicyDocument` is the only updatable field (via `PutRolePolicy` which acts as upsert)

### endpoints

| operation | command | description |
|-----------|---------|-------------|
| put (upsert) | `PutRolePolicyCommand` | creates or updates an inline policy on a role |
| get | `GetRolePolicyCommand` | retrieves an inline policy |
| list | `ListRolePoliciesCommand` | lists inline policy names on a role |
| delete | `DeleteRolePolicyCommand` | removes an inline policy |
| attach managed | `AttachRolePolicyCommand` | attaches a managed policy to a role |
| list attached | `ListAttachedRolePoliciesCommand` | lists attached managed policies |

### SdkAwsPutRolePolicyCommandInput

```typescript
interface SdkAwsPutRolePolicyCommandInput {
  RoleName: string;       // required - role to attach policy to
  PolicyName: string;     // required - name for the inline policy
  PolicyDocument: string; // required - json policy document
}
```

### SdkAwsGetRolePolicyCommandOutput

```typescript
interface SdkAwsGetRolePolicyCommandOutput {
  RoleName?: string;
  PolicyName?: string;
  PolicyDocument?: string;  // json policy (url-encoded)
  $metadata: SdkAwsResponseMetadata;
}
```

### SdkAwsListRolePoliciesCommandInput

```typescript
interface SdkAwsListRolePoliciesCommandInput {
  RoleName: string;     // required
  Marker?: string;      // pagination token
  MaxItems?: number;    // default: 100
}
```

### SdkAwsListRolePoliciesCommandOutput

```typescript
interface SdkAwsListRolePoliciesCommandOutput {
  PolicyNames?: string[];
  IsTruncated?: boolean;
  Marker?: string;
  $metadata: SdkAwsResponseMetadata;
}
```

### SdkAwsAttachRolePolicyCommandInput

```typescript
interface SdkAwsAttachRolePolicyCommandInput {
  RoleName: string;   // required
  PolicyArn: string;  // required - arn of managed policy
}
```

### SdkAwsListAttachedRolePoliciesCommandOutput

```typescript
interface SdkAwsListAttachedRolePoliciesCommandOutput {
  AttachedPolicies?: SdkAwsAttachedPolicy[];  // { PolicyName, PolicyArn }[]
  IsTruncated?: boolean;
  Marker?: string;
  $metadata: SdkAwsResponseMetadata;
}
```

---

## iam policy statement structure

iam policies are json documents with a specific grammar. the proper term for "iam statements" is **policy statements** within an **iam policy document**.

### SdkAwsIamPolicyDocument

```typescript
interface SdkAwsIamPolicyDocument {
  Version: "2012-10-17" | "2008-10-17";  // always use "2012-10-17"
  Id?: string;                            // optional identifier (resource-based only)
  Statement: SdkAwsIamPolicyStatement[];  // required array of statements
}
```

### SdkAwsIamPolicyStatement

```typescript
interface SdkAwsIamPolicyStatement {
  // optional identifier
  Sid?: string;

  // required - allow or deny
  Effect: "Allow" | "Deny";

  // required for resource-based/trust policies only
  Principal?: "*" | SdkAwsIamPrincipalMap;
  NotPrincipal?: "*" | SdkAwsIamPrincipalMap;

  // required - what actions (mutually exclusive: Action vs NotAction)
  Action?: string | string[];      // e.g., "s3:GetObject" or ["s3:GetObject", "s3:PutObject"]
  NotAction?: string | string[];

  // required - what resources (mutually exclusive: Resource vs NotResource)
  Resource?: string | string[];    // e.g., "arn:aws:s3:::bucket/*"
  NotResource?: string | string[];

  // optional - conditional logic
  Condition?: SdkAwsIamConditionBlock;
}

interface SdkAwsIamPrincipalMap {
  AWS?: string | string[];        // arn or account id
  Service?: string | string[];    // e.g., "lambda.amazonaws.com"
  Federated?: string | string[];
}

interface SdkAwsIamConditionBlock {
  [operator: string]: {           // e.g., "StringEquals", "ArnLike"
    [key: string]: string | string[];
  };
}
```

### trust policy example (for lambda execution role)

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "Service": "lambda.amazonaws.com"
      },
      "Action": "sts:AssumeRole"
    }
  ]
}
```

### permissions policy example

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AllowSSMAccess",
      "Effect": "Allow",
      "Action": [
        "ssm:DescribeParameters",
        "ssm:GetParameters"
      ],
      "Resource": "arn:aws:ssm:*:*:parameter/*"
    },
    {
      "Sid": "AllowLambdaInvoke",
      "Effect": "Allow",
      "Action": [
        "lambda:InvokeFunction",
        "lambda:InvokeAsync"
      ],
      "Resource": "*"
    }
  ]
}
```

---

## lambda function

package: `@aws-sdk/client-lambda`

### endpoints

| operation | command | description |
|-----------|---------|-------------|
| create | `CreateFunctionCommand` | creates a new lambda function |
| get | `GetFunctionCommand` | retrieves function config and code location |
| update code | `UpdateFunctionCodeCommand` | updates function code |
| update config | `UpdateFunctionConfigurationCommand` | updates function settings |
| delete | `DeleteFunctionCommand` | deletes a function |
| list | `ListFunctionsCommand` | lists all functions |

### SdkAwsCreateFunctionCommandInput

```typescript
interface SdkAwsCreateFunctionCommandInput {
  // required
  FunctionName: string;           // name or arn
  Role: string;                   // execution role arn
  Code: SdkAwsFunctionCode;       // deployment package

  // code source (one required in SdkAwsFunctionCode)
  // Code: { ZipFile?: Uint8Array, S3Bucket?: string, S3Key?: string, S3ObjectVersion?: string, ImageUri?: string }

  // runtime config (required for zip packages)
  Runtime?: SdkAwsRuntime;        // e.g., "nodejs20.x", "python3.12"
  Handler?: string;               // e.g., "dist/index.handler"

  // optional config
  Description?: string;
  Timeout?: number;               // seconds (default: 3, max: 900)
  MemorySize?: number;            // mb (default: 128, any multiple of 1)
  Environment?: SdkAwsEnvironment;  // { Variables: Record<string, string> }
  Tags?: Record<string, string>;

  // advanced
  Architectures?: SdkAwsArchitecture[];  // ["x86_64"] or ["arm64"]
  EphemeralStorage?: SdkAwsEphemeralStorage;  // { Size: number } (512-10240 mb)
  VpcConfig?: SdkAwsVpcConfig;    // { SubnetIds, SecurityGroupIds }
  Layers?: string[];              // layer arns
  DeadLetterConfig?: SdkAwsDeadLetterConfig;
  TracingConfig?: SdkAwsTracingConfig;  // { Mode: "Active" | "PassThrough" }
  KMSKeyArn?: string;
  FileSystemConfigs?: SdkAwsFileSystemConfig[];
  PackageType?: SdkAwsPackageType;  // "Zip" or "Image"
  ImageConfig?: SdkAwsImageConfig;
  SnapStart?: SdkAwsSnapStart;
  LoggingConfig?: SdkAwsLoggingConfig;

  // publish version on create
  Publish?: boolean;              // if true, publishes $LATEST as version 1
}
```

### SdkAwsLambdaFunctionConfiguration (returned from create/get/update)

```typescript
interface SdkAwsLambdaFunctionConfiguration {
  // identity
  FunctionName?: string;          // @uniqueKey - function name (unique within region+account)
  FunctionArn?: string;           // @readonly @primaryKey - amazon resource name
  Version?: string;               // @readonly - "$LATEST" or numeric version
  RevisionId?: string;            // @readonly - changes on every update (optimistic locking token)

  // code
  CodeSha256?: string;            // @readonly - sha256 hash of deployment package
  CodeSize?: number;              // @readonly - bytes
  PackageType?: SdkAwsPackageType;

  // runtime
  Runtime?: SdkAwsRuntime;
  Handler?: string;
  Role?: string;                  // execution role arn
  Timeout?: number;
  MemorySize?: number;
  Architectures?: SdkAwsArchitecture[];
  EphemeralStorage?: SdkAwsEphemeralStorage;

  // environment
  Environment?: SdkAwsEnvironmentResponse;
  VpcConfig?: SdkAwsVpcConfigResponse;
  Layers?: SdkAwsLayer[];

  // state
  State?: SdkAwsState;            // @readonly - "Pending" | "Active" | "Inactive" | "Failed"
  StateReason?: string;           // @readonly
  StateReasonCode?: SdkAwsStateReasonCode;  // @readonly
  LastModified?: string;          // @readonly - iso 8601
  LastUpdateStatus?: SdkAwsLastUpdateStatus;  // @readonly
  LastUpdateStatusReason?: string;  // @readonly
  LastUpdateStatusReasonCode?: SdkAwsLastUpdateStatusReasonCode;  // @readonly

  // observability
  Description?: string;
  TracingConfig?: SdkAwsTracingConfigResponse;
  LoggingConfig?: SdkAwsLoggingConfig;

  // other
  DeadLetterConfig?: SdkAwsDeadLetterConfig;
  KMSKeyArn?: string;
  MasterArn?: string;             // @readonly - for lambda@edge
  FileSystemConfigs?: SdkAwsFileSystemConfig[];
  ImageConfigResponse?: SdkAwsImageConfigResponse;
  SigningProfileVersionArn?: string;  // @readonly
  SigningJobArn?: string;         // @readonly
  SnapStart?: SdkAwsSnapStartResponse;
  RuntimeVersionConfig?: SdkAwsRuntimeVersionConfig;  // @readonly
}
```

### SdkAwsGetFunctionCommandInput

```typescript
interface SdkAwsGetFunctionCommandInput {
  FunctionName: string;   // required - name or arn
  Qualifier?: string;     // version or alias name
}
```

### SdkAwsGetFunctionCommandOutput

```typescript
interface SdkAwsGetFunctionCommandOutput {
  Configuration?: SdkAwsLambdaFunctionConfiguration;
  Code?: SdkAwsFunctionCodeLocation;  // { RepositoryType, Location, ImageUri, ResolvedImageUri }
  Tags?: Record<string, string>;
  TagsError?: SdkAwsTagsError;
  Concurrency?: SdkAwsConcurrency;  // { ReservedConcurrentExecutions }
  $metadata: SdkAwsResponseMetadata;
}
```

### SdkAwsUpdateFunctionCodeCommandInput

```typescript
interface SdkAwsUpdateFunctionCodeCommandInput {
  FunctionName: string;            // required

  // code source (one required)
  ZipFile?: Uint8Array;            // base64-encoded zip contents
  S3Bucket?: string;
  S3Key?: string;
  S3ObjectVersion?: string;
  ImageUri?: string;               // ecr image uri

  // options
  Publish?: boolean;               // publish new version after update
  DryRun?: boolean;                // validate without updating
  RevisionId?: string;             // optimistic locking
  Architectures?: SdkAwsArchitecture[];
  SourceKMSKeyArn?: string;        // for encrypted zip
}
```

### SdkAwsUpdateFunctionConfigurationCommandInput

```typescript
interface SdkAwsUpdateFunctionConfigurationCommandInput {
  FunctionName: string;            // required

  // all optional - only provided fields are updated
  Role?: string;
  Handler?: string;
  Description?: string;
  Timeout?: number;
  MemorySize?: number;
  Runtime?: SdkAwsRuntime;
  Environment?: SdkAwsEnvironment;
  VpcConfig?: SdkAwsVpcConfig;
  Layers?: string[];
  DeadLetterConfig?: SdkAwsDeadLetterConfig;
  TracingConfig?: SdkAwsTracingConfig;
  KMSKeyArn?: string;
  FileSystemConfigs?: SdkAwsFileSystemConfig[];
  ImageConfig?: SdkAwsImageConfig;
  EphemeralStorage?: SdkAwsEphemeralStorage;
  SnapStart?: SdkAwsSnapStart;
  LoggingConfig?: SdkAwsLoggingConfig;
  RevisionId?: string;             // optimistic locking
}
```

---

## lambda version

package: `@aws-sdk/client-lambda`

versions are immutable snapshots of a function's code and configuration. once published, they cannot be modified.

**key identity notes:**
- a version is uniquely identified by `FunctionName` + `Version` (composite unique key)
- the `FunctionArn` for a version includes the version number: `arn:aws:lambda:region:account:function:name:version`
- all properties of a version are @readonly after publication (immutable)

### endpoints

| operation | command | description |
|-----------|---------|-------------|
| publish | `PublishVersionCommand` | creates a new version from $LATEST |
| list | `ListVersionsByFunctionCommand` | lists all versions of a function |
| get | `GetFunctionCommand` (with Qualifier) | retrieves a specific version |
| delete | `DeleteFunctionCommand` (with Qualifier) | deletes a specific version |

### SdkAwsPublishVersionCommandInput

```typescript
interface SdkAwsPublishVersionCommandInput {
  FunctionName: string;       // required - name or arn
  CodeSha256?: string;        // verify code hasn't changed
  Description?: string;       // version description
  RevisionId?: string;        // verify config hasn't changed
}
```

### SdkAwsPublishVersionCommandOutput

returns `SdkAwsLambdaFunctionConfiguration` (same as create/update) with:
- `Version` = numeric version string (e.g., "1", "2", "3")
- `FunctionArn` = versioned arn (e.g., "arn:aws:lambda:us-east-1:123456789012:function:my-func:1")

```typescript
interface SdkAwsPublishVersionCommandOutput extends SdkAwsLambdaFunctionConfiguration {
  $metadata: SdkAwsResponseMetadata;
}
```

### SdkAwsListVersionsByFunctionCommandInput

```typescript
interface SdkAwsListVersionsByFunctionCommandInput {
  FunctionName: string;   // required
  Marker?: string;        // pagination token
  MaxItems?: number;      // max 50 per response
}
```

### SdkAwsListVersionsByFunctionCommandOutput

```typescript
interface SdkAwsListVersionsByFunctionCommandOutput {
  Versions?: SdkAwsLambdaFunctionConfiguration[];  // includes $LATEST + all versions
  NextMarker?: string;
  $metadata: SdkAwsResponseMetadata;
}
```

---

## lambda alias

package: `@aws-sdk/client-lambda`

aliases are named pointers to specific versions. they enable:
- traffic shifting between versions
- stable endpoints that can be updated without changing consumers
- environment-based routing (e.g., "LIVE", "STAGING")

### endpoints

| operation | command | description |
|-----------|---------|-------------|
| create | `CreateAliasCommand` | creates a new alias |
| get | `GetAliasCommand` | retrieves alias details |
| update | `UpdateAliasCommand` | updates alias to point to different version |
| list | `ListAliasesCommand` | lists all aliases for a function |
| delete | `DeleteAliasCommand` | deletes an alias |

### SdkAwsCreateAliasCommandInput

```typescript
interface SdkAwsCreateAliasCommandInput {
  FunctionName: string;       // required - function name or arn
  Name: string;               // required - alias name (e.g., "LIVE", "v1")
  FunctionVersion: string;    // required - version to point to (e.g., "1", "42")
  Description?: string;
  RoutingConfig?: SdkAwsAliasRoutingConfiguration;  // for traffic splitting
}
```

### SdkAwsAliasRoutingConfiguration

```typescript
interface SdkAwsAliasRoutingConfiguration {
  AdditionalVersionWeights?: Record<string, number>;
  // e.g., { "2": 0.1 } = 10% traffic to version 2, 90% to primary version
}
```

### SdkAwsGetAliasCommandInput

```typescript
interface SdkAwsGetAliasCommandInput {
  FunctionName: string;   // required
  Name: string;           // required - alias name
}
```

### SdkAwsLambdaAliasConfiguration (returned from create/get/update/list)

```typescript
interface SdkAwsLambdaAliasConfiguration {
  AliasArn?: string;              // @readonly @primaryKey - e.g., "arn:aws:lambda:us-east-1:123456789012:function:my-func:LIVE"
  Name?: string;                  // @uniqueKey(composite: FunctionName+Name) - alias name
  FunctionVersion?: string;       // version it points to
  Description?: string;
  RoutingConfig?: SdkAwsAliasRoutingConfiguration;
  RevisionId?: string;            // @readonly - changes on update (optimistic locking token)
}
```

note: the alias is uniquely identified by the composite key of `FunctionName` + `Name`. the `FunctionName` is provided in the command input, not returned in the configuration.

### SdkAwsUpdateAliasCommandInput

```typescript
interface SdkAwsUpdateAliasCommandInput {
  FunctionName: string;           // required
  Name: string;                   // required - alias name
  FunctionVersion?: string;       // new version to point to
  Description?: string;
  RoutingConfig?: SdkAwsAliasRoutingConfiguration;
  RevisionId?: string;            // optimistic locking
}
```

### SdkAwsListAliasesCommandInput

```typescript
interface SdkAwsListAliasesCommandInput {
  FunctionName: string;       // required
  FunctionVersion?: string;   // filter to aliases pointing to this version
  Marker?: string;
  MaxItems?: number;
}
```

### SdkAwsListAliasesCommandOutput

```typescript
interface SdkAwsListAliasesCommandOutput {
  Aliases?: SdkAwsLambdaAliasConfiguration[];
  NextMarker?: string;
  $metadata: SdkAwsResponseMetadata;
}
```

### SdkAwsDeleteAliasCommandInput

```typescript
interface SdkAwsDeleteAliasCommandInput {
  FunctionName: string;   // required
  Name: string;           // required - alias name to delete
}
```

---

## sources

- [aws sdk for javascript v3 - iam client](https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/client/iam/)
- [aws sdk for javascript v3 - lambda client](https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/client/lambda/)
- [iam json policy reference](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies.html)
- [iam json policy grammar](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_grammar.html)
- [role interface](https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/Package/-aws-sdk-client-iam/Interface/Role/)
