# feedback.v1 review - items missed

## status summary

| blocker | status | notes |
|---------|--------|-------|
| 1 | ✅ addressed | delLambdaAlias/delLambdaVersion use `by: { ref }` pattern |
| 2 | ✅ addressed | renamed to getOne*/getAll* pattern |
| 3 | ✅ addressed | getAllLambdaAliases uses `by: { lambda }` |
| 4 | ✅ addressed | DeclaredAwsIamPrincipal uses camelCase (aws, service, federated) |
| 5 | ✅ addressed | DeclaredAwsIamRole comment now generic, not lambda-specific |
| 6 | ❌ MISSED | nested declaration uses `DeclaredAwsIamRole` not `RefByUnique<DeclaredAwsIamRole>` |
| 7 | ⚠️ partial | DeclaredAwsLambda no longer has `qualifier`, but need to verify all attributes match blueprint |
| 8 | ✅ addressed | all casting done via `castIntoDeclaredAws*` procedures |
| 9 | ✅ addressed | only one index.ts exists (`contract/sdks/index.ts`) which is the public sdk export |
| 10 | ✅ addressed | `castFromDeclaredAws*` functions exist |
| 11 | ✅ addressed | renamed to `castInto*` pattern |
| 12 | ✅ addressed | no `throw new Error` found in src |
| 13 | ✅ addressed | castInto functions exist per domain object |
| 14 | ✅ addressed | no `as RefByUnique` casts in prodcode |
| 15 | ✅ addressed | no `as RefByUnique` casts remain |
| 16 | ✅ addressed | getOneLambdaAlias uses `names: { ... } \| null` pattern |
| 17 | ✅ addressed | getOneLambdaAlias looks up version config for real sha256 values |
| 18 | ✅ addressed | uses `.catch()` pattern instead of try/catch |
| 19 | ✅ addressed | getAllLambdaAliases looks up version config for real sha256 |
| 20 | ✅ addressed | no `as RefByUnique` casts |
| 21 | ✅ addressed | delLambdaVersion guards against $LATEST deletion |
| 22 | ✅ addressed | castIntoDeclaredAwsLambdaVersion computes configSha256 internally |
| 23 | ❌ MISSED | `existing` term still used in setIamRole.ts (existingTags) and test files |
| 24 | ✅ addressed | uses `isRefByUnique/Primary({ of: X })` pattern |

---

## items that need fixing

### blocker.6 - nested should be RefByUnique, not domain object

**location**: `src/domain.objects/DeclaredAwsIamRolePolicy.ts:61-64`

**current**:
```ts
public static nested = {
  role: DeclaredAwsIamRole,
  statements: DeclaredAwsIamPolicyStatement,
};
```

**expected**:
```ts
public static nested = {
  role: RefByUnique<typeof DeclaredAwsIamRole>,
  statements: DeclaredAwsIamPolicyStatement,
};
```

**reason**: the `role` interface field is typed as `RefByUnique<typeof DeclaredAwsIamRole>`, so nested should match

---

### blocker.23 - term `existing` still used

**locations**:
- `src/domain.operations/iamRole/setIamRole.ts:78,81,95` - uses `existingTags`
- `src/domain.operations/iamRole/setIamRole.test.ts:68,69,74,79,86,91,92` - uses `existingRole`
- `src/domain.operations/lambdaAlias/setLambdaAlias.test.ts:90,91,96,105,113,118` - uses `existingAlias`
- `src/domain.operations/lambdaAlias/setLambdaAlias.integration.test.ts:108` - comment uses "existing"
- `src/domain.operations/lambdaAlias/getOneLambdaAlias.integration.test.ts:12` - uses "existing"
- `src/domain.objects/DeclaredAwsLambdaVersion.ts:16,71` - comments use "existing"

**expected**: rename all to `foundBefore` / `tagsBefore` / `roleBefore` / `aliasBefore` pattern

---

## items to verify (partial)

### blocker.7 - DeclaredAwsLambda updates

verified that `qualifier` is not in DeclaredAwsLambda, but user mentioned "we know for a fact that it needs significant updates" - should verify against the original blueprint if there's one
