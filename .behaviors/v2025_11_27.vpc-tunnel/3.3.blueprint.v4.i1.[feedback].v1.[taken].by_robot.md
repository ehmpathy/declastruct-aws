# feedback response: blueprint v4

## blocker.1 — use serialize from domain-objects

**issue**: using `JSON.stringify` instead of `serialize` from domain-objects

**resolution**: changed `getTunnelHash` to import and use `serialize` from domain-objects for deterministic serialization

---

## blocker.2 — TunnelCacheFile.tunnel should be RefByUnique

**issue**: `TunnelCacheFile` interface stored full `DeclaredAwsVpcTunnel` instead of just the reference

**resolution**: changed to `tunnel: RefByUnique<typeof DeclaredAwsVpcTunnel>` — we only need the reference for identity, not mutable state

---

## nitpick.3 — remove redundant bastion.id check

**issue**: explicit `if (!bastion.id)` check is redundant when `getEc2Instance` returns `HasMetadata<DeclaredAwsEc2Instance>` which already guarantees `id` is present

**resolution**: removed the guard clause since TypeScript already ensures `id` is present via the return type

---

## blocker.4 — add getDeclastructAwsProvider factory

**issue**: missing the factory function that instantiates context with default paths

**resolution**: added `getDeclastructAwsProvider` factory in `src/logic/getDeclastructAwsProvider.ts` which:
- sets default `cache.DeclaredAwsVpcTunnel.processes.dir` to `~/.declastruct/tunnels`
- accepts optional overrides for region, account, and cache paths
- follows existing provider factory patterns
