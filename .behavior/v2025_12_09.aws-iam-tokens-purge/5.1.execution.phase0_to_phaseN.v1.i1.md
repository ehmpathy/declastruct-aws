# Execution Log: IAM User Access Key Purge

## Phase 1: Foundation — Domain Objects

### 1.1 DeclaredAwsIamUser
- [x] create `src/domain.objects/DeclaredAwsIamUser.ts`
- [x] create `src/domain.objects/DeclaredAwsIamUser.test.ts`

### 1.2 DeclaredAwsIamUserAccessKey
- [x] create `src/domain.objects/DeclaredAwsIamUserAccessKey.ts`
- [x] create `src/domain.objects/DeclaredAwsIamUserAccessKey.test.ts`

---

## Phase 2: IAM User Operations

### 2.1 castIntoDeclaredAwsIamUser
- [x] create `src/domain.operations/iamUser/castIntoDeclaredAwsIamUser.ts`
- [x] create `src/domain.operations/iamUser/castIntoDeclaredAwsIamUser.test.ts`

### 2.2 getAllIamUsers
- [x] create `src/domain.operations/iamUser/getAllIamUsers.ts`
- [ ] create `src/domain.operations/iamUser/getAllIamUsers.integration.test.ts`

### 2.3 getOneIamUser
- [x] create `src/domain.operations/iamUser/getOneIamUser.ts`
- [ ] create `src/domain.operations/iamUser/getOneIamUser.integration.test.ts`

---

## Phase 3: IAM Access Key Operations

### 3.1 castIntoDeclaredAwsIamUserAccessKey
- [x] create `src/domain.operations/iamUserAccessKey/castIntoDeclaredAwsIamUserAccessKey.ts`
- [ ] create `src/domain.operations/iamUserAccessKey/castIntoDeclaredAwsIamUserAccessKey.test.ts`

### 3.2 getAllIamUserAccessKeys
- [x] create `src/domain.operations/iamUserAccessKey/getAllIamUserAccessKeys.ts`
- [ ] create `src/domain.operations/iamUserAccessKey/getAllIamUserAccessKeys.integration.test.ts`

### 3.3 getOneIamUserAccessKey
- [x] create `src/domain.operations/iamUserAccessKey/getOneIamUserAccessKey.ts`
- [ ] create `src/domain.operations/iamUserAccessKey/getOneIamUserAccessKey.integration.test.ts`

### 3.4 delIamUserAccessKey
- [x] create `src/domain.operations/iamUserAccessKey/delIamUserAccessKey.ts`
- [ ] create `src/domain.operations/iamUserAccessKey/delIamUserAccessKey.integration.test.ts`

### 3.5 setIamUserAccessKey
- [x] create `src/domain.operations/iamUserAccessKey/setIamUserAccessKey.ts`
- [ ] create `src/domain.operations/iamUserAccessKey/setIamUserAccessKey.test.ts`

---

## Phase 4: Access DAOs

### 4.1 DeclaredAwsIamUserDao
- [x] create `src/access/daos/DeclaredAwsIamUserDao.ts`

### 4.2 DeclaredAwsIamUserAccessKeyDao
- [x] create `src/access/daos/DeclaredAwsIamUserAccessKeyDao.ts`

---

## Phase 5: Verification

### 5.1 Type Check
- [x] run `npm run test:types` ✅ passed

### 5.2 Unit Tests
- [x] run unit tests for all new files ✅ 28 tests passed

### 5.3 Lint Check
- [x] run `npm run test:lint` ✅ passed

### 5.4 Integration Tests
- [ ] run integration tests for all new files (deferred - requires AWS credentials)

---

## Summary

### Files Created

**Domain Objects:**
- `src/domain.objects/DeclaredAwsIamUser.ts`
- `src/domain.objects/DeclaredAwsIamUser.test.ts`
- `src/domain.objects/DeclaredAwsIamUserAccessKey.ts`
- `src/domain.objects/DeclaredAwsIamUserAccessKey.test.ts`

**IAM User Operations:**
- `src/domain.operations/iamUser/castIntoDeclaredAwsIamUser.ts`
- `src/domain.operations/iamUser/castIntoDeclaredAwsIamUser.test.ts`
- `src/domain.operations/iamUser/getAllIamUsers.ts`
- `src/domain.operations/iamUser/getOneIamUser.ts`

**IAM User Access Key Operations:**
- `src/domain.operations/iamUserAccessKey/castIntoDeclaredAwsIamUserAccessKey.ts`
- `src/domain.operations/iamUserAccessKey/getAllIamUserAccessKeys.ts`
- `src/domain.operations/iamUserAccessKey/getOneIamUserAccessKey.ts`
- `src/domain.operations/iamUserAccessKey/delIamUserAccessKey.ts`
- `src/domain.operations/iamUserAccessKey/setIamUserAccessKey.ts` (fail-fast)

**DAOs:**
- `src/access/daos/DeclaredAwsIamUserDao.ts`
- `src/access/daos/DeclaredAwsIamUserAccessKeyDao.ts`

### Key Decisions

1. **Access Keys have no unique key** - only `accessKeyId` as primary key
2. **set operations fail fast** - IAM access keys are superseded by SSO/OIDC
3. **getOneIamUser by primary throws** - AWS IAM API doesn't support GetUserById
4. **delIamUserAccessKey is idempotent** - returns success if key already deleted
