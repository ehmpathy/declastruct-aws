# Response to Feedback v9

## Checklist

- [x] **Blocker.1**: Replace `as { X }` type casts with proper ref resolution using `getRefByPrimaryOf*` helpers
  - [x] Create `getRefByPrimaryOfSsoPermissionSet` resolver
  - [x] Create `getRefByPrimaryOfSsoUser` resolver
  - [x] Create `getRefByPrimaryOfOrganizationAccount` resolver
  - [x] Update `getAllSsoAccountAssignments.ts` - replace type casts with resolvers
  - [x] Update `delSsoAccountAssignment.ts` - replace type casts with resolvers
  - [x] Update `getOneSsoAccountAssignment.ts` - replace type casts with resolvers
  - [x] Run tests to verify

## Execution Log

### Blocker.1: Replace `as { X }` type casts with proper ref resolution

**Problem identified**: The pattern `(by.permissionSet as { arn?: string })?.arn` is a fail-hide because:
- If given a `RefByUnique<typeof PermissionSet>` (which has no `arn`), it silently returns `undefined`
- This causes the code to return `null` instead of properly resolving the ref or failing fast

**Solution**: Created `getRefByPrimaryOf*` helper functions that:
1. If `isRefByPrimary` → return the ref directly
2. If `isRefByUnique` → call `getOne*` to resolve, failfast if not found, then return `{ primary: value }`

### New files created:

1. `src/domain.operations/ssoPermissionSet/getRefByPrimaryOfSsoPermissionSet.ts`
   - Resolves any `Ref<typeof DeclaredAwsSsoPermissionSet>` to `RefByPrimary<typeof DeclaredAwsSsoPermissionSet>` (with `arn`)
   - Uses `isRefByPrimary`/`isRefByUnique` checks
   - Calls `getOneSsoPermissionSet` if unique ref, failfasts if not found

2. `src/domain.operations/ssoUser/getRefByPrimaryOfSsoUser.ts`
   - Resolves any `Ref<typeof DeclaredAwsSsoUser>` to `RefByPrimary<typeof DeclaredAwsSsoUser>` (with `id`)

3. `src/domain.operations/organizationAccount/getRefByPrimaryOfOrganizationAccount.ts`
   - Resolves any `Ref<typeof DeclaredAwsOrganizationAccount>` to `RefByPrimary<typeof DeclaredAwsOrganizationAccount>` (with `id`)

### Files updated:

1. `src/domain.operations/ssoAccountAssignment/getAllSsoAccountAssignments.ts`
   - Replaced: `(input.where.permissionSet as { arn?: string })?.arn` → `getRefByPrimaryOfSsoPermissionSet({ ref: ... })`
   - Replaced: `(input.where.target as { id?: string })?.id` → `getRefByPrimaryOfOrganizationAccount({ ref: ... })`

2. `src/domain.operations/ssoAccountAssignment/delSsoAccountAssignment.ts`
   - Replaced all 3 type casts with proper resolver calls

3. `src/domain.operations/ssoAccountAssignment/getOneSsoAccountAssignment.ts`
   - Replaced all 3 type casts with proper resolver calls

4. `src/domain.operations/ssoAccountAssignment/getOneSsoAccountAssignment.test.ts`
   - Updated tests to mock the new resolver functions
   - Changed "fail-hide" tests to "proper resolution" tests

## Verification
- All 453 tests pass
- Types check successfully
- Lint passes
