# Domain Research: AWS Account Provisioning

## Wish Summary
> "it were easy to provision a new aws account with declastruct-aws"
> e.g., for the usecase of creation of a demo account to use for ehmpathy public tests
> e.g., ehmpathy-cicd-public account

---

## Domain Objects

### Entities

#### 1. Account
The primary entity representing an AWS member account within an organization.

**Properties:**

| Property | Type | Constraints | Description |
|----------|------|-------------|-------------|
| `Id` | String | Max 12 chars; Pattern: `^\d{12}$` | "The unique identifier (ID) of the account" [1] |
| `Arn` | String | Pattern: `^arn:aws:organizations::\d{12}:account\/o-[a-z0-9]{10,32}\/\d{12}` | "The Amazon Resource Name (ARN) of the account" [1] |
| `Email` | String | Min: 6, Max: 64 chars; Pattern: `[^\s@]+@[^\s@]+\.[^\s@]+` | "The email address associated with the AWS account" [1] |
| `Name` | String | Min: 1, Max: 50 chars; Pattern: `[\s\S]*` | "The friendly name of the account" [1] |
| `State` | AccountState | Enum | "Represents a specific phase in the account lifecycle" [1] |
| `Status` | AccountStatus | Enum | "The status of the account in the organization" (deprecated, retiring Sept 9, 2026) [1] |
| `JoinedMethod` | JoinedMethod | Enum | "The method by which the account joined the organization" [1] |
| `JoinedTimestamp` | Timestamp | - | "The date the account became a part of the organization" [1] |

**Source:** [1] https://docs.aws.amazon.com/organizations/latest/APIReference/API_Account.html

---

#### 2. Organization
The root entity representing an AWS Organization.

**Properties:**

| Property | Type | Constraints | Description |
|----------|------|-------------|-------------|
| `Id` | String | Pattern: `^o-[a-z0-9]{10,32}$` | "The unique identifier (ID) of an organization" [2] |
| `Arn` | String | Pattern: `^arn:aws:organizations::\d{12}:organization\/o-[a-z0-9]{10,32}` | "The Amazon Resource Name (ARN) of an organization" [2] |
| `FeatureSet` | FeatureSet | Enum: `ALL`, `CONSOLIDATED_BILLING` | "Indicates available organizational functionality" [2] |
| `MasterAccountId` | String | Max: 12 chars; Pattern: `^\d{12}$` | "The unique identifier (ID) of the management account" [2] |
| `MasterAccountArn` | String | ARN pattern | "The Amazon Resource Name (ARN) of the account that is designated as the management account" [2] |
| `MasterAccountEmail` | String | Min: 6, Max: 64 chars | "Email associated with the management account" [2] |
| `AvailablePolicyTypes` | PolicyTypeSummary[] | - | Deprecated; use ListRoots instead [2] |

**Source:** [2] https://docs.aws.amazon.com/organizations/latest/APIReference/API_Organization.html

---

#### 3. OrganizationalUnit
A container for accounts within an organization.

**Properties:**

| Property | Type | Constraints | Description |
|----------|------|-------------|-------------|
| `Id` | String | Max: 68 chars; Pattern: `^ou-[a-z0-9]{4,32}-[a-z0-9]{8,32}$` | "The unique identifier (ID) associated with this OU" [3] |
| `Arn` | String | ARN pattern | "The Amazon Resource Name (ARN) of this OU" [3] |
| `Name` | String | Min: 1, Max: 128 chars | "The friendly name of this OU" [3] |

**Source:** [3] https://docs.aws.amazon.com/organizations/latest/APIReference/API_OrganizationalUnit.html

---

#### 4. CreateAccountStatus
Tracks the status of an asynchronous account creation request.

**Properties:**

| Property | Type | Constraints | Description |
|----------|------|-------------|-------------|
| `Id` | String | Max: 36 chars; Pattern: `^car-[a-z0-9]{8,32}$` | "The unique identifier (ID) that references this request" [4] |
| `AccountId` | String | Max: 12 chars; Pattern: `^\d{12}$` | "If the account was created successfully, the unique identifier (ID) of the new account" [4] |
| `AccountName` | String | Min: 1, Max: 50 chars; Pattern: `[\u0020-\u007E]+` | "The name assigned during account creation" [4] |
| `State` | CreateAccountState | Enum | "The status of the asynchronous request to create an AWS account" [4] |
| `FailureReason` | FailureReason | Enum | "If the request failed, a description of the reason for the failure" [4] |
| `RequestedTimestamp` | Timestamp | - | "The date and time that the request was made for the account creation" [4] |
| `CompletedTimestamp` | Timestamp | - | "The date and time that the account was created and the request completed" [4] |
| `GovCloudAccountId` | String | Max: 12 chars; Pattern: `^\d{12}$` | "If the account was created successfully, the ID for the new account in the AWS GovCloud (US) Region" [4] |

**Source:** [4] https://docs.aws.amazon.com/organizations/latest/APIReference/API_CreateAccountStatus.html

---

### Literals (Enums)

#### AccountState
"Each state represents a specific phase in the account lifecycle" [1]

| Value | Description |
|-------|-------------|
| `PENDING_ACTIVATION` | "An account has not completed the sign-up process" [5] |
| `ACTIVE` | "An account has completed the sign-up process and is ready for use or already being utilized" [5] |
| `SUSPENDED` | "An account is suspended by AWS" [5] |
| `PENDING_CLOSURE` | "An active account with an open account closure request" [5] |
| `CLOSED` | Account closure is complete [5] |

**Source:** [5] https://aws.amazon.com/blogs/mt/updates-to-account-status-information-in-aws-organizations/

---

#### AccountStatus (Deprecated - retiring Sept 9, 2026)

| Value |
|-------|
| `ACTIVE` |
| `SUSPENDED` |
| `PENDING_CLOSURE` |

---

#### JoinedMethod

| Value | Description |
|-------|-------------|
| `INVITED` | Account was invited to join the organization |
| `CREATED` | Account was created within the organization |

---

#### CreateAccountState

| Value | Description |
|-------|-------------|
| `IN_PROGRESS` | Account creation is in progress |
| `SUCCEEDED` | Account creation completed successfully |
| `FAILED` | Account creation failed |

**Source:** [4] https://docs.aws.amazon.com/organizations/latest/APIReference/API_CreateAccountStatus.html

---

#### FailureReason
"If the request failed, a description of the reason for the failure" [4]

| Value | Description |
|-------|-------------|
| `ACCOUNT_LIMIT_EXCEEDED` | "The account couldn't be created because you reached the limit on the number of accounts in your organization" [6] |
| `EMAIL_ALREADY_EXISTS` | "The account could not be created because another AWS account with that email address already exists" [6] |
| `INVALID_ADDRESS` | "The account could not be created because the address you provided is not valid" [6] |
| `INVALID_EMAIL` | "The account could not be created because the email address you provided is not valid" [6] |
| `CONCURRENT_ACCOUNT_MODIFICATION` | "You already submitted a request with the same information" [6] |
| `INTERNAL_FAILURE` | Internal AWS failure |
| `GOVCLOUD_ACCOUNT_ALREADY_EXISTS` | GovCloud account already exists |
| `MISSING_BUSINESS_VALIDATION` | Business validation missing |
| `FAILED_BUSINESS_VALIDATION` | Business validation failed |
| `PENDING_BUSINESS_VALIDATION` | Business validation pending |
| `INVALID_IDENTITY_FOR_BUSINESS_VALIDATION` | Invalid identity for business validation |
| `UNKNOWN_BUSINESS_VALIDATION` | Unknown business validation error |
| `MISSING_PAYMENT_INSTRUMENT` | "You must configure the management account with a valid payment method, such as a credit card" [6] |
| `INVALID_PAYMENT_INSTRUMENT` | Invalid payment instrument |
| `UPDATE_EXISTING_RESOURCE_POLICY_WITH_TAGS_NOT_SUPPORTED` | Cannot update existing resource policy with tags |

**Source:** [6] https://docs.aws.amazon.com/organizations/latest/APIReference/API_DescribeCreateAccountStatus.html

---

#### FeatureSet

| Value | Description |
|-------|-------------|
| `ALL` | "enables all features and policy application" [2] |
| `CONSOLIDATED_BILLING` | "provides only billing consolidation" [2] |

---

#### IamUserAccessToBilling

| Value | Description |
|-------|-------------|
| `ALLOW` | IAM users in the member account can access billing (default) |
| `DENY` | IAM users in the member account cannot access billing |

---

### Events

#### Account Lifecycle Events (CloudTrail)
- `CreateAccountResult` - "published after the account closes successfully" [7]
- Account state changes are observable via DescribeAccount polling or CloudTrail events

**Source:** [7] https://docs.aws.amazon.com/organizations/latest/APIReference/API_CloseAccount.html

---

## Domain Operations

### Create Operations (setCreate)

#### CreateAccount
"Creates an Amazon Web Services account that is automatically a member of the organization whose credentials made the request. This is an asynchronous request that Amazon Web Services performs in the background." [8]

**Request Parameters:**

| Parameter | Type | Required | Constraints |
|-----------|------|----------|-------------|
| `AccountName` | String | Yes | 1-50 chars; pattern: `[\u0020-\u007E]+` |
| `Email` | String | Yes | 6-64 chars; 7-bit ASCII; must contain exactly one @ symbol |
| `IamUserAccessToBilling` | String | No | Values: `ALLOW` or `DENY` (defaults to `ALLOW`) |
| `RoleName` | String | No | Max 64 chars; pattern: `[\w+=,.@-]{1,64}`; defaults to `OrganizationAccountAccessRole` |
| `Tags` | Tag[] | No | Array of Tag objects |

**Response:** `CreateAccountStatus` object

**Key Constraints:**
- "The user who calls the API to create an account must have the organizations:CreateAccount permission" [8]
- "If the request includes tags, then the requester must have the organizations:TagResource permission" [8]
- "This operation can be called only from the organization's management account" [8]
- "Using the CreateAccount API to close accounts is subject to a 30-day usage quota" [8]

**Source:** [8] https://docs.aws.amazon.com/organizations/latest/APIReference/API_CreateAccount.html

---

### Read Operations (getOne)

#### DescribeAccount
"Retrieves AWS Organizations-related information about the specified account" [9]

**Request Parameters:**

| Parameter | Type | Required | Constraints |
|-----------|------|----------|-------------|
| `AccountId` | String | Yes | Max 12 chars; Pattern: `^\d{12}$` |

**Response:** `Account` object

**Source:** [9] https://docs.aws.amazon.com/organizations/latest/APIReference/API_DescribeAccount.html

---

#### DescribeCreateAccountStatus
"Retrieves the current status of an asynchronous request to create an account" [6]

**Request Parameters:**

| Parameter | Type | Required | Constraints |
|-----------|------|----------|-------------|
| `CreateAccountRequestId` | String | Yes | Pattern: `^car-[a-z0-9]{8,32}$` |

**Response:** `CreateAccountStatus` object

**Source:** [6] https://docs.aws.amazon.com/organizations/latest/APIReference/API_DescribeCreateAccountStatus.html

---

### List Operations (getAll)

#### ListAccounts
"Lists all the accounts in the organization" [10]

**Request Parameters:**

| Parameter | Type | Required | Constraints |
|-----------|------|----------|-------------|
| `MaxResults` | Integer | No | Valid Range: 1-20 |
| `NextToken` | String | No | Max: 100,000 chars |

**Response:** Array of `Account` objects + `NextToken`

**Pagination:** "When calling List* operations, always check the NextToken response parameter value, even if you receive an empty result set" [10]

**Source:** [10] https://docs.aws.amazon.com/organizations/latest/APIReference/API_ListAccounts.html

---

#### ListAccountsForParent
"Lists the accounts in an organization that are contained by the specified target root or organizational unit (OU)" [11]

**Request Parameters:**

| Parameter | Type | Required | Constraints |
|-----------|------|----------|-------------|
| `ParentId` | String | Yes | Root or OU ID |
| `MaxResults` | Integer | No | Valid Range: 1-20 |
| `NextToken` | String | No | Max: 100,000 chars |

**Response:** Array of `Account` objects + `NextToken`

**Source:** [11] https://docs.aws.amazon.com/organizations/latest/APIReference/API_ListAccountsForParent.html

---

#### ListCreateAccountStatus
"Lists the account creation requests that match the specified status that is currently being tracked for the organization" [12]

**Request Parameters:**

| Parameter | Type | Required | Constraints |
|-----------|------|----------|-------------|
| `States` | String[] | No | Filter by states: `IN_PROGRESS`, `SUCCEEDED`, `FAILED` |
| `MaxResults` | Integer | No | - |
| `NextToken` | String | No | - |

**Response:** Array of `CreateAccountStatus` objects + `NextToken`

**Source:** [12] https://docs.aws.amazon.com/organizations/latest/APIReference/API_ListCreateAccountStatus.html

---

### Update Operations (setUpdate)

#### MoveAccount
"Moves an account from its current source parent root or organizational unit (OU) to the specified destination parent root or OU" [13]

**Request Parameters:**

| Parameter | Type | Required | Constraints |
|-----------|------|----------|-------------|
| `AccountId` | String | Yes | Max 12 chars; Pattern: `^\d{12}$` |
| `SourceParentId` | String | Yes | Max 100 chars; Pattern: `^(r-[0-9a-z]{4,32})\|(ou-[0-9a-z]{4,32}-[a-z0-9]{8,32})$` |
| `DestinationParentId` | String | Yes | Max 100 chars; Pattern: `^(r-[0-9a-z]{4,32})\|(ou-[0-9a-z]{4,32}-[a-z0-9]{8,32})$` |

**Response:** Empty (HTTP 200)

**Source:** [13] https://docs.aws.amazon.com/organizations/latest/APIReference/API_MoveAccount.html

---

#### TagResource
"Adds one or more tags to the specified resource" [14]

**Request Parameters:**

| Parameter | Type | Required | Constraints |
|-----------|------|----------|-------------|
| `ResourceId` | String | Yes | Max 130 chars; accepts account ID, OU ID, root ID, or policy ID |
| `Tags` | Tag[] | Yes | Array of Tag objects (key-value pairs) |

**Response:** Empty (HTTP 200)

**Source:** [14] https://docs.aws.amazon.com/organizations/latest/APIReference/API_TagResource.html

---

### Delete Operations (setDelete)

#### CloseAccount
"Closes an AWS member account within an organization" [7]

**Request Parameters:**

| Parameter | Type | Required | Constraints |
|-----------|------|----------|-------------|
| `AccountId` | String | Yes | Max 12 chars; Pattern: `^\d{12}$` |

**Response:** Empty (HTTP 200)

**Key Constraints:**
- "You can close only 10% of member accounts, between 10 and 1000, within a rolling 30 day period" [7]
- "To reinstate a closed account, contact AWS Support within the 90-day grace period while the account is in SUSPENDED status" [7]
- Asynchronous operation - account transitions from `PENDING_CLOSURE` to `SUSPENDED`

**Source:** [7] https://docs.aws.amazon.com/organizations/latest/APIReference/API_CloseAccount.html

---

#### RemoveAccountFromOrganization
"Removes the specified account from the organization" [15]

**Request Parameters:**

| Parameter | Type | Required | Constraints |
|-----------|------|----------|-------------|
| `AccountId` | String | Yes | Max 12 chars; Pattern: `^\d{12}$` |

**Response:** Empty (HTTP 200)

**Key Notes:**
- "The removed account becomes a standalone account that isn't a member of any organization" [15]
- "You can remove an account from your organization only if the account is configured with the information required to operate as a standalone account" [15]

**Source:** [15] https://docs.aws.amazon.com/organizations/latest/APIReference/API_RemoveAccountFromOrganization.html

---

## SDK Reference

### @aws-sdk/client-organizations (JavaScript/TypeScript v3)

Installation:
```bash
npm install @aws-sdk/client-organizations
```

Usage:
```typescript
import { OrganizationsClient, CreateAccountCommand } from "@aws-sdk/client-organizations";

const client = new OrganizationsClient({ region: "us-east-1" });
const command = new CreateAccountCommand({
  AccountName: "my-account-name",
  Email: "account@example.com"
});
const response = await client.send(command);
```

**Important:** "AWS SDK for JavaScript v2 entered maintenance mode on September 8, 2024 and reached end-of-support on September 8, 2025" [16]

**Source:** [16] https://aws.amazon.com/blogs/developer/announcing-end-of-support-for-aws-sdk-for-javascript-v2/

---

## Operations Summary Table

| Operation Category | Operation | SDK Method | Description |
|-------------------|-----------|------------|-------------|
| **setCreate** | CreateAccount | `CreateAccountCommand` | Create new member account (async) |
| **getOne** | DescribeAccount | `DescribeAccountCommand` | Get account details by ID |
| **getOne** | DescribeCreateAccountStatus | `DescribeCreateAccountStatusCommand` | Get creation request status |
| **getAll** | ListAccounts | `ListAccountsCommand` | List all organization accounts |
| **getAll** | ListAccountsForParent | `ListAccountsForParentCommand` | List accounts in OU/root |
| **getAll** | ListCreateAccountStatus | `ListCreateAccountStatusCommand` | List creation requests |
| **setUpdate** | MoveAccount | `MoveAccountCommand` | Move account between OUs |
| **setUpdate** | TagResource | `TagResourceCommand` | Add tags to account |
| **setDelete** | CloseAccount | `CloseAccountCommand` | Close member account (async) |
| **setDelete** | RemoveAccountFromOrganization | `RemoveAccountFromOrganizationCommand` | Remove account from org |

---

## Citations

1. AWS Organizations API Reference - Account Data Type: https://docs.aws.amazon.com/organizations/latest/APIReference/API_Account.html
2. AWS Organizations API Reference - Organization Data Type: https://docs.aws.amazon.com/organizations/latest/APIReference/API_Organization.html
3. AWS Organizations API Reference - OrganizationalUnit Data Type: https://docs.aws.amazon.com/organizations/latest/APIReference/API_OrganizationalUnit.html
4. AWS Organizations API Reference - CreateAccountStatus Data Type: https://docs.aws.amazon.com/organizations/latest/APIReference/API_CreateAccountStatus.html
5. AWS Cloud Operations Blog - Account State Information: https://aws.amazon.com/blogs/mt/updates-to-account-status-information-in-aws-organizations/
6. AWS Organizations API Reference - DescribeCreateAccountStatus: https://docs.aws.amazon.com/organizations/latest/APIReference/API_DescribeCreateAccountStatus.html
7. AWS Organizations API Reference - CloseAccount: https://docs.aws.amazon.com/organizations/latest/APIReference/API_CloseAccount.html
8. AWS Organizations API Reference - CreateAccount: https://docs.aws.amazon.com/organizations/latest/APIReference/API_CreateAccount.html
9. AWS Organizations API Reference - DescribeAccount: https://docs.aws.amazon.com/organizations/latest/APIReference/API_DescribeAccount.html
10. AWS Organizations API Reference - ListAccounts: https://docs.aws.amazon.com/organizations/latest/APIReference/API_ListAccounts.html
11. AWS Organizations API Reference - ListAccountsForParent: https://docs.aws.amazon.com/organizations/latest/APIReference/API_ListAccountsForParent.html
12. AWS Organizations API Reference - ListCreateAccountStatus: https://docs.aws.amazon.com/organizations/latest/APIReference/API_ListCreateAccountStatus.html
13. AWS Organizations API Reference - MoveAccount: https://docs.aws.amazon.com/organizations/latest/APIReference/API_MoveAccount.html
14. AWS Organizations API Reference - TagResource: https://docs.aws.amazon.com/organizations/latest/APIReference/API_TagResource.html
15. AWS Organizations API Reference - RemoveAccountFromOrganization: https://docs.aws.amazon.com/organizations/latest/APIReference/API_RemoveAccountFromOrganization.html
16. AWS Developer Tools Blog - End of Support for SDK v2: https://aws.amazon.com/blogs/developer/announcing-end-of-support-for-aws-sdk-for-javascript-v2/
17. NPM - @aws-sdk/client-organizations: https://www.npmjs.com/package/@aws-sdk/client-organizations
18. AWS SDK for JavaScript v3 Documentation: https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/client/organizations/
