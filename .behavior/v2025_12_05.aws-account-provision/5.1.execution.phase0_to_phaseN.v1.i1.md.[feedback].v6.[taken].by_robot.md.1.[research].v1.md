# aws account domain research

## sources

- [DescribeAccount - AWS Organizations](https://docs.aws.amazon.com/organizations/latest/APIReference/API_DescribeAccount.html)
- [ListAccounts - AWS Organizations](https://docs.aws.amazon.com/organizations/latest/APIReference/API_ListAccounts.html)
- [GetCallerIdentity - AWS STS](https://docs.aws.amazon.com/STS/latest/APIReference/API_GetCallerIdentity.html)
- [ListTagsForResource - AWS Organizations](https://docs.aws.amazon.com/organizations/latest/APIReference/API_ListTagsForResource.html)

---

## domain.objects

### Account (from AWS Organizations)

the core domain object. available via DescribeAccount and ListAccounts.

```ts
interface Account {
  Id: string;           // 12-digit account id (e.g., "123456789012")
  Arn: string;          // account arn
  Name: string;         // friendly name
  Email: string;        // root email
  State: string;        // PENDING_ACTIVATION | ACTIVE | SUSPENDED | PENDING_CLOSURE | CLOSED
  Status: string;       // deprecated, retiring sept 2026 - use State instead
  JoinedMethod: string; // INVITED | CREATED
  JoinedTimestamp: number; // unix timestamp
}
```

### CallerIdentity (from AWS STS)

minimal identity info. always available, no org required.

```ts
interface CallerIdentity {
  Account: string;  // 12-digit account id
  Arn: string;      // caller's arn (user, role, or federated)
  UserId: string;   // unique id of calling entity
}
```

### Tag (from AWS Organizations)

```ts
interface Tag {
  Key: string;
  Value: string;
}
```

---

## domain.operations

### by.auth - get current account

**simplest approach**: use STS GetCallerIdentity

- always works (no permissions required)
- returns account id
- does NOT return name, email, state, or org info

if we need more info, we can try to hydrate via DescribeAccount afterward.

```
STS.GetCallerIdentity() → { Account: "123456789012", Arn: "...", UserId: "..." }
```

### by.id - get account by id

**if in organization**: use Organizations.DescribeAccount

- requires org membership and permissions
- returns full Account object

**if standalone**: no direct api exists
- can only return minimal info (id, synthetic arn)

```
Organizations.DescribeAccount({ AccountId }) → { Account: { ... } }
```

### by.email - search account by email

**requires organization**: use Organizations.ListAccounts + filter

- must iterate all accounts (paginated, max 20 per page)
- no direct email lookup api exists

```
Organizations.ListAccounts() → { Accounts: [...] } → filter by email
```

### tags - get account tags

**requires organization**: use Organizations.ListTagsForResource

```
Organizations.ListTagsForResource({ ResourceId: accountId }) → { Tags: [...] }
```

---

## key insights

1. **STS GetCallerIdentity is the foundation**
   - always works
   - no permissions required
   - gives us account id to start with

2. **organization context is optional**
   - some accounts are standalone (not in any org)
   - org operations fail for standalone accounts

3. **email lookup requires full scan**
   - no direct api to get account by email
   - must ListAccounts and filter

4. **three distinct scenarios**:
   - standalone account → minimal info only (id, synthetic arn/name/email)
   - org member, looking up self → DescribeAccount works
   - org member, looking up other → DescribeAccount works (if permitted)

5. **the current implementation is too complex**
   - tries to check org first, then hydrate
   - should instead: just try DescribeAccount, fallback on error
